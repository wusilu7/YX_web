{{include file="../common/1header.html"}}
<link href="{{CSS}}jin/3.01.selectretention.css" rel="stylesheet">
<style type="text/css">
    .col-sm-1 {
        width: 90px;
        padding-top: 8px;
    }
    .alert-info{
        color: white;
    }
    .form-group{
        margin-bottom: 35px;
    }
    #server_top .dropdown-header .text{
        font-size: 20px;
        color: black;
        font-weight: 500;
    }
    .text_content{
        margin-left: 35px;
    }
    .dropdown-header{
        padding: 10px 20px;
    }
    #server_top{
        width: 100px
    }
    #group{
        width: 100%
    }
    .table > tbody > tr > td{
        width: 120px;
        padding: 8px 0px;
    }
    .table > tbody > tr > td:nth-child(1),
    .table > thead > tr > td:nth-child(1),
    .table > tbody > tr > td:nth-child(2),
    .table > thead > tr > td:nth-child(2){
        width: 50px;
    }
</style>
<!--|↓↓↓↓↓↓|-->
<div class="jin-content-title"><span>账号渠道留存率</span></div>
<div class="alert alert-info">
    {{if $Mobel == 'Mobel'}}
        <div class="form-group" id="group_server_7_mobel"></div>
    {{else}}
        <div class="form-group" id="group_server_7"></div>
    {{/if}}
</div>
<!--查询div-->
<hr/>
<div class="jin-search-div">
    <label for="time_start">日期：</label>
    <input size="16" type="text" id="time_start" class="form-control jin-datetime"
           placeholder="开始日期">
    -
    <input size="16" type="text" id="time_end" class="form-control jin-datetime"
           placeholder="结束日期">
    <select id="type" style="padding: 8px;">
        <option value="a">综合</option>
        <option value="b">付费</option>
        <option value="c">免费</option>
    </select>
    <a id="jin_search" class="btn btn-success"><span class="glyphicon glyphicon-search"></span></a>
    <a id="jin_excel" class="btn btn-danger">保存到Excel</a>
</div>
<hr/>
<div class="table-responsive jin-table-12px">
    <table class="table table-striped text-center jin-retention-table">
        <thead>
        <tr>
            <th class="jin-retention-column1">日期</th>
            <th>创角数</th>
            <th>2日留存</th>
            <th>3日留存</th>
            <th>4日留存</th>
            <th>5日留存</th>
            <th>6日留存</th>
            <th>7日留存</th>
            <th>15日留存</th>
            <th>30日留存</th>
            <th>60日留存</th>
        </tr>
        </thead>
        <tbody id="content"></tbody>
    </table>
</div>
<div id="page"></div>
<div class="jin-explain">
    <b>说明</b>：
    <div>
        ① 1天、2天、3天……n天 代表创角日的n天后登录的角色数；
    </div>
</div>
<!--|↑↑↑↑↑↑|-->
{{include file="../common/2footer.html"}}
<script type="text/javascript">
    gsSelect3('#g', '#p', '#s');
    calendar('month', '#time_start', '#time_end');


    var url = location.href + "&jinIf=912";
    var arr = [];
    var id = ["#content", "#page"];
    var data = {};
    console.log(arr);
    function getRetention() {
        switch ($("#type").val()){
            case 'a':
                var numin1 = function (json) {
                    return json.numchar_a1 + ' ( ' + json.ar1+ ' )';
                };
                var numin2 = function (json) {
                    return json.numchar_a2 + ' ( ' + json.ar2+ ' )';
                };
                var numin3 = function (json) {
                    return json.numchar_a3 + ' ( ' + json.ar3+ ' )';
                };
                var numin4 = function (json) {
                    return json.numchar_a4 + ' ( ' + json.ar4+ ' )';
                };
                var numin5 = function (json) {
                    return json.numchar_a5 + ' ( ' + json.ar5+ ' )';
                };
                var numin6 = function (json) {
                    return json.numchar_a6 + ' ( ' + json.ar6+ ' )';
                };
                var numin15 = function (json) {
                    return json.numchar_a15 + ' ( ' + json.ar15+ ' )';
                };
                var numin30 = function (json) {
                    return json.numchar_a30 + ' ( ' + json.ar30+ ' )';
                };
                var numin60 = function (json) {
                    return json.numchar_a60 + ' ( ' + json.ar60+ ' )';
                };
                break;
            case 'b':
                var numin1 = function (json) {
                    return json.numchar_b1 + ' ( ' + json.br1+ ' )';
                };
                var numin2 = function (json) {
                    return json.numchar_b2 + ' ( ' + json.br2+ ' )';
                };
                var numin3 = function (json) {
                    return json.numchar_b3 + ' ( ' + json.br3+ ' )';
                };
                var numin4 = function (json) {
                    return json.numchar_b4 + ' ( ' + json.br4+ ' )';
                };
                var numin5 = function (json) {
                    return json.numchar_b5 + ' ( ' + json.br5+ ' )';
                };
                var numin6 = function (json) {
                    return json.numchar_b6 + ' ( ' + json.br6+ ' )';
                };
                var numin15 = function (json) {
                    return json.numchar_b15 + ' ( ' + json.br15+ ' )';
                };
                var numin30 = function (json) {
                    return json.numchar_b30 + ' ( ' + json.br30+ ' )';
                };
                var numin60 = function (json) {
                    return json.numchar_b60 + ' ( ' + json.br60+ ' )';
                };
                break;
            case 'c':
                var numin1 = function (json) {
                    return json.numchar_c1 + ' ( ' + json.cr1+ ' )';
                };
                var numin2 = function (json) {
                    return json.numchar_c2 + ' ( ' + json.cr2+ ' )';
                };
                var numin3 = function (json) {
                    return json.numchar_c3 + ' ( ' + json.cr3+ ' )';
                };
                var numin4 = function (json) {
                    return json.numchar_c4 + ' ( ' + json.cr4+ ' )';
                };
                var numin5 = function (json) {
                    return json.numchar_c5 + ' ( ' + json.cr5+ ' )';
                };
                var numin6 = function (json) {
                    return json.numchar_c6 + ' ( ' + json.cr6+ ' )';
                };
                var numin15 = function (json) {
                    return json.numchar_c15 + ' ( ' + json.cr15+ ' )';
                };
                var numin30 = function (json) {
                    return json.numchar_c30 + ' ( ' + json.cr30+ ' )';
                };
                var numin60 = function (json) {
                    return json.numchar_c60 + ' ( ' + json.cr60+ ' )';
                };
                break;
        }

        arr = ['date', 'numchar_'+$("#type").val(), numin1, numin2, numin3, numin4, numin5, numin6, numin15, numin30, numin60];
        data.page       = 1;
        data.group      = $('#g').val();
        data.pi         = $('#p').val();
        data.stype      = $('#type').val();

        data.time_start = $('#time_start').val();//查询开始时间
        data.time_end   = $('#time_end').val();//查询结束时间
        $.cookie('cookie_g', data.group, {expires: 30});
        tableList(url, data, id, arr);
    }
    // 普通查询
    $("#jin_search").on('click', function () {
        data.check_type = 912;
        getRetention();
    });
    $("#jin_excel").on('click', function () {
        data.page = 'excel';  // 生成excel表
        $.ajax({
            type: "post",
            url: location.href + '&jinIf=951',
            data: data,
            dataType: "json",
            beforeSend: function () {
                layer.load(2, {
                    shade: [0.3, '#fff']
                });
            },
            success: function (output) {
                layer.closeAll('loading');
                location.href = output;
            },
            error: function () {
                layer.closeAll('loading');
                layer.msg('文件下载失败，请缩小筛选条件后再次下载');
            }
        });
    });
</script>
