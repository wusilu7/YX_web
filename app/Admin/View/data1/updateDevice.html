{{include file="../common/1header.html"}}
<link href="{{CSS}}jin/3.01.selectretention.css" rel="stylesheet">
<style type="text/css">
    .col-sm-1 {
        width: 90px;
        padding-top: 8px;
    }
    .alert-info{
        color: white;
    }
    .form-group{
        margin-bottom: 35px;
    }
    #server_top .dropdown-header .text{
        font-size: 20px;
        color: black;
        font-weight: 500;
    }
    .text_content{
        margin-left: 35px;
    }
    .dropdown-header{
        padding: 10px 20px;
    }
    #server_top{
        width: 100px
    }
    #group{
        width: 100%
    }
    .table > tbody > tr > td{
        padding: 8px 0px;
    }
    .table > tbody > tr > td:nth-child(1),
    .table > thead > tr > td:nth-child(1),
    .table > tbody > tr > td:nth-child(2),
    .table > thead > tr > td:nth-child(2){

    }
</style>
<!--|↓↓↓↓↓↓|-->
<div class="jin-content-title"><span>设备更新记录</span></div>
<div class="alert alert-info">
    {{if $Mobel == 'Mobel'}}
        <div class="form-group" id="group_server_5_mobel"></div>
    {{else}}
        <div class="form-group" id="group_server_5"></div>
    {{/if}}
</div>
<!--查询div-->
<hr/>
<div class="jin-search-div">
    <label for="time_start">日期：</label>
    <input size="16" type="text" id="time_start" class="form-control jin-datetime"
           placeholder="开始日期">
    -
    <input size="16" type="text" id="time_end" class="form-control jin-datetime"
           placeholder="结束日期">
    <input size="30" type="text" id="deviceID" class="form-control jin-search-input"
           placeholder="设备ID">
    <input size="16" type="text" id="updateFlag" class="form-control jin-search-input"
           placeholder="updateFlag">
    <input size="16" type="text" id="curVersion1" class="form-control jin-search-input"
           placeholder="curVersion1">
    <input size="16" type="text" id="curVersion2" class="form-control jin-search-input"
           placeholder="curVersion2">
    <a id="jin_search" class="btn btn-success"><span class="glyphicon glyphicon-search"></span></a>
    <a id="jin_excel" class="btn btn-danger">保存到Excel</a>

</div>
<hr/>
<div class="table-responsive jin-table-12px">
    <table class="table table-striped text-center jin-retention-table">
        <thead>
        <tr>
            <th>编号</th>
            <th>日期</th>
            <th>设备ID</th>
            <th>设备类型</th>
            <th>updateFlag</th>
            <th>curVersion</th>
            <th>failureDes</th>
            <th>角色信息</th>
        </tr>
        </thead>
        <tbody id="content"></tbody>
    </table>
</div>
<div id="page"></div>
<!--|↑↑↑↑↑↑|-->
{{include file="../common/2footer.html"}}
<script type="text/javascript">
    gsSelect3('#g', '#p', '#s');
    calendar('hour', '#time_start', '#time_end');
    

    var url = location.href + "&jinIf=912";
    var arr = ['ids','create_time', 'deviceID', 'deviceModel', 'updateFlag','curVersion', 'failureDes', 'char'];
    var id = ["#content", "#page"];
    var data = {};
    function getRetention() {
        data.page       = 1;
        data.group      = $('#g').val();
        data.pi         = $('#p').val();
        data.si         = $('#s').val();
        data.deviceID   = $('#deviceID').val();
        data.updateFlag = $('#updateFlag').val();
        data.curVersion1 = $('#curVersion1').val();
        data.curVersion2= $('#curVersion2').val();
        data.time_start = $('#time_start').val();//查询开始时间
        data.time_end   = $('#time_end').val();//查询结束时间
        $.cookie('cookie_g', data.group, {expires: 30});
        $.cookie('cookie_s', data.si, {expires: 30});
        tableList(url, data, id, arr);
    }
    // 普通查询
    $("#jin_search").on('click', function () {
        data.check_type = 912;
        getRetention();
    });
     //服务器汇总
     $("#server_summary").on('click', function () {
         data.check_type = 998;
         getRetention();
     });
    // 渠道汇总
    $("#group_summary").on('click', function () {
        data.check_type = 999;
        giCollect(getRetention);
    });
    $("#jin_excel").on('click', function () {
        data.page = 'excel';  // 生成excel表
        $.ajax({
            type: "post",
            url: location.href + '&jinIf=951',
            data: data,
            dataType: "json",
            beforeSend: function () {
                layer.load(2, {
                    shade: [0.3, '#fff']
                });
            },
            success: function (output) {
                layer.closeAll('loading');
                location.href = output;
            },
            error: function () {
                layer.closeAll('loading');
                layer.msg('文件下载失败，请缩小筛选条件后再次下载');
            }
        });
    });
</script>
