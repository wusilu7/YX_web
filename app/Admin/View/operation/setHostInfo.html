{{include file="../common/1header.html"}}
<link href="{{CSS}}jin/3.08.group.css" rel="stylesheet">
<!--|↓↓↓↓↓↓|-->
<div class="jin-content-title"><span>主机信息配置</span></div>
<button data-type="insert" class="btn btn-success" style="margin-bottom: 5px;">新增</button><br>
<input id="type" type="text" class="form-control jin-search-input">
<a id="jin_search" class="btn btn-success"><span class="glyphicon glyphicon-search"></span></a>
<div class="table-responsive">
    <table class="table table-striped table-bordered text-center jin-group-table">
        <thead>
        <tr>
            <th>编号</th>
            <th>主机名</th>
            <th>IP</th>
            <th>svn_repo</th>
            <th>svn_dir</th>
            <th>类型</th>
            <th>备注</th>
            <th class="jin-group-column9">操作</th>
        </tr>
        </thead>
        <tbody id="content"></tbody>
    </table>
</div>
<div id="page"></div>

<!--|↑↑↑↑↑↑|-->
{{include file="../common/2footer.html"}}
<script>
    var url = location.href + '&jinIf=912';
    var btn = function (json) {
        return '<div class="btn-group btn-group-sm" data-data-id="'+json.id+'">' +
            '<button data-type="update" class=" btn btn-primary">修改</button>' +
            '<button data-type="delete" class="btn btn-danger">删除</button>' +
            '</div>'
    };
    var arr = ['ids', 'host_name', 'ip', 'svn_repo', 'svn_dir','type','remark', btn];
    var id = "#content";
    var data = {};
    $(document).ready(noPageContentList(url, data, id, arr));
    $("#jin_search").on('click', function () {
        data.types = $("#type").val();
        noPageContentList(url, data, id, arr)
    });


    $('button[data-type="insert"]').on('click', function () {//新增渠道
        var docW = window.screen.width;
        if(docW < 768){
            layerW = '80%';
            layerH = '80%';
        }else{
            layerW = '560px';
            layerH = '600px;';
        }
        layer.open({
            type: 1,
            closeBtn: 2,
            title: '新增渠道',
            area: [layerW, layerH],
            btn: ['新增', '取消'],
            btnAlign: 'c',
            shadeClose: false, //点击遮罩
            content: '<div class="jin-child" style="margin-top: -3px;">' +
            '<div class="input-group"><span class="input-group-addon">类型</span><input id="types" type="text" class="form-control"></div>' +
            '<div class="input-group"><span class="input-group-addon">主机名</span><input id="host_name" type="text" class="form-control"></div>' +
            '<div class="input-group"><span class="input-group-addon">IP</span><input id="ip" type="text" class="form-control"></div>' +
            '<div class="input-group"><span class="input-group-addon">svn_repo</span><input id="svn_repo" type="text" class="form-control" ></div>' +
            '<div class="input-group"><span class="input-group-addon">svn_dir</span><input id="svn_dir" type="text" class="form-control" ></div>' +
            '<div class="input-group"><span class="input-group-addon">备注</span><textarea  id="remark" cols="30" rows="10" class="form-control"></textarea></div>' +
            '</div>',
            yes: function (index) {
                $.ajax({
                    type: "POST",
                    url: location.href + '&jinIf=911',
                    data: {
                        types: $('#types').val(),
                        host_name: $('#host_name').val(),
                        ip: $('#ip').val(),
                        svn_repo: $('#svn_repo').val(),
                        svn_dir: $('#svn_dir').val(),
                        remark: $('#remark').val()
                    },
                    success: function (res) {
                        layer.close(index);
                        layer.alert('添加成功', {icon: 1}, function (index) {
                            layer.close(index);
                            noPageContentList(url, data, id, arr);
                        });

                    }
                });
            },
            cancel: function () {
            }
        })
    });

    $('#content').on('click', 'button[data-type="update"]', function () {//修改渠道
        var ids = $(this).parent().attr("data-data-id");
        var host_name = $(this).parents('tr').find('td').eq(1).text();
        var ip = $(this).parents('tr').find('td').eq(2).text();
        var svn_repo = $(this).parents('tr').find('td').eq(3).text();
        var svn_dir = $(this).parents('tr').find('td').eq(4).text();
        var types = $(this).parents('tr').find('td').eq(5).text();
        var remark = $(this).parents('tr').find('td').eq(6).text();
        var docW = window.screen.width;
        if(docW < 768){
            layerW = '80%';
            layerH = '80%';
        }else{
            layerW = '560px';
            layerH = '600px;';
        }
        layer.open({
            type: 1,
            closeBtn: 2,
            title: '渠道修改',
            area: [layerW, layerH],
            btn: ['修改', '取消'],
            btnAlign: 'c',
            shadeClose: true, //点击遮罩关闭
            content: '<div class="jin-child">' +
            '<div class="input-group"><span class="input-group-addon">类型</span><input id="types" value="' +
            types +
            '" type="text" class="form-control"></div>' +
            '<div class="input-group"><span class="input-group-addon">主机名</span><input id="host_name" value="' +
            host_name +
            '" type="text" class="form-control"></div>' +
            '<div class="input-group"><span class="input-group-addon">IP</span><input id="ip" value="' +
            ip +
            '" type="text" class="form-control"></div>' +
            '<div class="input-group"><span class="input-group-addon">svn_repo</span><input id="svn_repo" value="' +
            svn_repo +
            '" type="text" class="form-control"></div>' +
            '<div class="input-group"><span class="input-group-addon">svn_dir</span><input id="svn_dir" value="' +
            svn_dir +
            '" type="text" class="form-control"></div>' +
            '<div class="input-group"><span class="input-group-addon">备注</span><textarea  id="remark" cols="30" rows="10" class="form-control">'+remark+'</textarea></div>' +
            '</div>',
            yes: function (index) {
                $.ajax({
                    type: "POST",
                    url: location.href + '&jinIf=913',
                    data: {
                        id: ids,
                        host_name: $('#host_name').val(),
                        ip: $('#ip').val(),
                        svn_repo: $('#svn_repo').val(),
                        svn_dir: $('#svn_dir').val(),
                        types: $('#types').val(),
                        remark: $('#remark').val()
                    },
                    success: function () {
                        layer.close(index);
                        layer.alert('修改成功', {icon: 1}, function (index) {
                            layer.close(index);
                            noPageContentList(url, data, id, arr);
                        });
                    }
                });
            },
            cancel: function () {
            }

        });
    }).on('click', 'button[data-type="delete"]', function () {//删除组
        var ids = $(this).parent().attr("data-data-id");

        layer.alert('确认删除？', {icon: 0, shadeClose: true, btn: ['确定', '取消']}, function () {
                $.ajax({
                    type: "POST",
                    url: location.href + '&jinIf=914',
                    data: {
                        id: ids
                    },
                    success: function () {
                        layer.alert('删除成功', {icon: 1}, function (index) {
                            layer.close(index);
                            noPageContentList(url, data, id, arr);
                        });
                    }
                });
        });
    });
</script>