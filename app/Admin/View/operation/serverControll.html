{{include file="../common/1header.html"}}
<link href="{{CSS}}jin/3.06.server.css" rel="stylesheet">

<style type="text/css">
    .server_red{color: red;}
    .server_green{color: green;}
    #open_other_ip{
        width: 50px;
        zoom: 140%;
    }
</style>
<!--|↓↓↓↓↓↓|-->
<div class="jin-content-title"><span>服务器管制</span></div>
<div class="jin-server-select" style="display:none">
    <select id="group" class="left">
        <option></option>
    </select>
</div>
<div class="jin-server-select">
    <button data-type="all_display" class="btn btn-info">全部显示</button>
    <button data-type="all_sum" class="btn btn-info">已勾选汇总</button>
    <button data-type="all_show" class="btn btn-info">已勾选显示</button>
</div>
<div class="table-responsive">
    <table class="table table-bordered table-striped text-center jin-server-table">
        <thead>
        <tr>
            <th>渠道名称</th>
            <th>服务器ID</th>
            <th>服务器名称</th>
            <th>汇总</th>
            <th>显示</th>
        </tr>
        </thead>
        <tbody id="content"></tbody>
    </table>
    
</div>
<!--|↑↑↑↑↑↑|-->
{{include file="../common/2footer.html"}}
<script type="text/javascript">
    var url = location.href + '&jinIf=912';
    var arr = ['group_name', 'server_id', 'name', 'online', 'is_show'];
    var id = "#content";
    var data = {};
    //选渠道下拉框（定制版，可选择所有）
    groupSelectAll();
    
    // 渠道类型定制版
    function groupSelectAll(obj) {
        obj = isExist(obj, {});
        obj.dom = isExist(obj.dom, "#group");
        obj.width = isExist(obj.width, "230px");
        obj.url = isExist(obj.url, "?p=Admin&c=Operation&a=group&jinIf=9421");
        obj.id = isExist(obj.id, "group_id");
        obj.text = isExist(obj.text, "group_name");
        jinSelect(obj);
    }

    $("#group").on('change', function () {
        data.group_id = $("#group").val();
        noPageContentList(url, data, id, arr);
    });

    //全部显示
    $('button[data-type="all_display"]').on('click', function () {
        $.ajax({
            type: "POST",
            url: location.href + "&jinIf=912",
            data: data,
            success: function (json) {
                noPageContentList(url, data, id, arr);
            }
        });
    });

    //已勾选汇总
    $('button[data-type="all_sum"]').on('click', function () {
        data.sum = 'yes';
        $.ajax({
            type: "POST",
            url: location.href + "&jinIf=913",
            data: data,
            success: function (json) {
                var url = location.href + "&jinIf=913";
                noPageContentList(url, data, id, arr);
            }
        });
    });

    //已勾选显示
    $('button[data-type="all_show"]').on('click', function () {
        data.show = 'yes';
        $.ajax({
            type: "POST",
            url: location.href + "&jinIf=914",
            data: data,
            success: function (json) {
                var url = location.href + "&jinIf=914";
                noPageContentList(url, data, id, arr);
            }
        });
    });

    // 获取选中的服务器
    function getChoose(type = 1) {
        var server_id = '';
        var name = '';
        if (type == 2) {
            var white_ip    = '';
            var app_version = '';
            var res_version = '';
        }

        $('#content input[type="checkbox"]:checked').each(function(index, el) {
            if (index == 0) {
                server_id = $(el).val();
                name = $(el).parent('td').siblings('td').eq(2).text();
            } else {
                server_id += ',' + $(el).val();
                name += ',' + $(el).parent('td').siblings('td').eq(2).text();
            }
        });

        return {
            'server_id': server_id,
            'name': name
        };
    }

    $('#content').on('click', 'span[data-type="no"]', function () {  // 点击后在游戏服务器列表中显示服务器
        removeBackgroud($(this))
        var server_id = $(this).parents('tr').find('td').eq(1).text();
        var name = $(this).parents('tr').find('td').eq(2).text();
        layer.alert('确认显示[' + name + ']服务器？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=9133",
                data: {
                    server_id: server_id
                },
                dataType: 'json',
                success: function (json) {
                    if (json.status == 1) {
                        layer.alert('已在游戏服务器列表中显示', {icon: 1}, function (index) {
                            layer.close(index);
                            noPageContentList(url, data, id, arr);
                        });
                    } else {
                        layer.alert(json.msg, {icon: 2}, function (index) {
                            layer.close(index);
                        })
                    }
                }
            });
        });
    }).on('click', 'span[data-type="yes"]', function () {  // 点击后在游戏服务器列表中隐藏服务器
        removeBackgroud($(this))
        var server_id = $(this).parents('tr').find('td').eq(1).text();
        var name = $(this).parents('tr').find('td').eq(2).text();
        layer.alert('确认隐藏[' + name + ']服务器？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=9134",
                data: {
                    server_id: server_id
                },
                dataType: 'json',
                success: function (json) {
                    if (json.status == 1) {
                        layer.alert('已在游戏服务器列表中隐藏', {icon: 1}, function (index) {
                            layer.close(index);
                            noPageContentList(url, data, id, arr);
                        });
                    } else {
                        layer.alert(json.msg, {icon: 2}, function (index) {
                            layer.close(index);
                        })
                    }
                }
            });
        });
    }).on('click', 'span[data-type="off"]', function () {  // 点击后改为线上数据库
        removeBackgroud($(this))
        var server_id = $(this).parents('tr').find('td').eq(1).text();
        var name = $(this).parents('tr').find('td').eq(2).text();
        layer.alert('确认把[' + name + ']服务器改为线上数据库？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=9137",
                data: {
                    server_id: server_id
                },
                dataType: 'json',
                success: function (json) {
                    if (json.status == 1) {
                        layer.alert('已改为线上数据库', {icon: 1}, function (index) {
                            layer.close(index);
                            noPageContentList(url, data, id, arr);
                        });
                    } else {
                        layer.alert(json.msg, {icon: 2}, function (index) {
                            layer.close(index);
                        })
                    }
                }
            });
        });
    }).on('click', 'span[data-type="on"]', function () {  // 点击后本地数据库
        removeBackgroud($(this))
        var server_id = $(this).parents('tr').find('td').eq(1).text();
        var name = $(this).parents('tr').find('td').eq(2).text();
        layer.alert('确认把[' + name + ']服务器改为本地数据库？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=9138",
                data: {
                    server_id: server_id
                },
                dataType: 'json',
                success: function (json) {
                    if (json.status == 1) {
                        layer.alert('已改为本地数据库', {icon: 1}, function (index) {
                            layer.close(index);
                            noPageContentList(url, data, id, arr);
                        });
                    } else {
                        layer.alert(json.msg, {icon: 2}, function (index) {
                            layer.close(index);
                        })
                    }
                }
            });
        });
    }).on('click', 'tr', function() {
        var cb = $(this).find('td:first>input');
        if (! cb.is(':checked')) {
            cb.attr('checked', true);
            $(this).attr('style', 'background: #aba5618c');
        } else {
            cb.attr('checked', false);
            $(this).removeAttr('style', 'background: #aba5618c');
        }
    })

    // 禁止点击tr默认选中
    function removeBackgroud(obj) {
        var tr = $(obj).parents('tr');
        var cb = tr.find('td:first>input');
        if (! cb.is(':checked')) {
            cb.attr('checked', true);
            tr.attr('style', 'background: #aba5618c');
        } else {
            cb.attr('checked', false);
            tr.removeAttr('style', 'background: #aba5618c');
        }
    }

    $('span[dir=ltr]').css("width", '220px');
</script>
