{{include file="../common/1header.html"}}

<style type="text/css">
    .bs-actionsbox .btn-group .btn{
        width: 33.3%;
    }

</style>

<div class="jin-content-title"><span>团购活动配置</span></div>
<div class="alert alert-info">
     <div id="group_only" style="display: inline-block;"></div>
    <a id="jin_search" class="btn btn-warning"><span class="glyphicon glyphicon-search"></span></a>
    <a id="jin_add" class="btn btn-info jin_add">添加团购商品</a>
</div>
<div class="select_group_div">
    <select id="g" class="selectpicker show-tick form-control" multiple data-live-search="true" data-actions-box="true" title="请选择"></select>
</div>
<div class="select_server_div">
    <select id="s" class="selectpicker show-tick form-control" multiple data-live-search="true" data-actions-box="true" title="请选择"></select>
</div>
<button id="send_valid" class="btn btn-success">应用有效商品</button>
<hr/>
<div class="table-responsive">
    <table class="table table-striped text-center">
        <thead>
        <tr>
            <th>编号</th>
            <th>档位</th>
            <th>开启时间</th>
            <th>持续时间</th>
            <th>奖励(物品)</th>
            <th>奖励(货币)</th>
            <th>原始价格</th>
            <th>限制货币类型</th>
            <th>条件及下限</th>
        </tr>
        </thead>
        <tbody id="content"></tbody>
    </table>
</div>
<div id="page"></div>

{{include file="../common/2footer.html"}}

<script type="text/javascript">
    gsSelect('#group');
    gsSelect3('#g','','#s');
    var url = location.href + "&jinIf=912";
    var btn = [
        '<a data-type="update" class="btn btn-primary">修改</a>'
    ];
    var arr = ['id','gear_id', 'start_time', 'duration_time', 'item', 'money', 'original_price','cy', 'lower_consumption',btn];
    var id = "#content";
    var data = {};

    function common() {
        data.gi=$("#group").val();
        noPageContentList(url, data, id, arr);
    }
    $("#jin_search").on('click', function () {
        common();
    });

    $("#jin_add").on('click', function () {
        layer.open({
            type: 1,
            closeBtn: 2,
            title: '添加团购商品',
            area: ['540px', '800px'],
            btn: ['确认', '取消'],
            btnAlign: 'c',
            shadeClose: true, //点击遮罩关闭
            content:'<div class="jin-child">' +
            '<div class="input-group"><span class="input-group-addon">档位ID</span><input type="text" id="gear_id"  class="form-control" style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">开启时间</span><input type="text" id="starttime" class="form-control jin-datetime-long"></div>' +
            '<div class="input-group"><span class="input-group-addon">持续时间</span><input type="text" id="durationtime"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">奖励-亡灵游侠(0)</span><input type="text" id="item0"  class="form-control" placeholder="物品1#数量1#-1;物品2#数量2#-1;"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">奖励-亡灵游侠(1)</span><input type="text" id="item1"  class="form-control"  placeholder="物品1#数量1#-1;物品2#数量2#-1;" style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">奖励-维京战士(10)</span><input type="text" id="item10"  class="form-control" placeholder="物品1#数量1#-1;物品2#数量2#-1;"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">奖励-维京战士(11)</span><input type="text" id="item11"  class="form-control" placeholder="物品1#数量1#-1;物品2#数量2#-1;"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">奖励-法师(20)</span><input type="text" id="item20"  class="form-control" placeholder="物品1#数量1#-1;物品2#数量2#-1;"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">奖励-货币</span><input type="text" id="money"  class="form-control" placeholder="货币1#数量1;货币2#数量2;"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">原始价格</span><input type="text" id="original_price"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">限制货币类型</span><input type="text" id="cy"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件1下限</span><input type="text" id="lower_limit1" value="0"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件1消耗</span><input type="text" id="consumption1"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件2下限</span><input type="text" id="lower_limit2" value="10"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件2消耗</span><input type="text" id="consumption2"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件3下限</span><input type="text" id="lower_limit3" value="30"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件3消耗</span><input type="text" id="consumption3"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件4下限</span><input type="text" id="lower_limit4" value="50"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件4消耗</span><input type="text" id="consumption4"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件5下限</span><input type="text" id="lower_limit5" value="100"  class="form-control"  style="text-align: center;"></div>' +
            '<div class="input-group"><span class="input-group-addon">条件5消耗</span><input type="text" id="consumption5"  class="form-control"  style="text-align: center;"></div>' +
            '</div>',
            yes: function (index1) {
                $.ajax({
                    type: "POST",
                    url: location.href + "&jinIf=911",
                    data: {
                        gi:$("#group").val(),
                        gear_id: $("#gear_id").val(),
                        start_time: $("#starttime").val(),
                        duration_time: $("#durationtime").val(),
                        item0: $("#item0").val(),
                        item1: $("#item1").val(),
                        item10: $("#item10").val(),
                        item11: $("#item11").val(),
                        item20: $("#item20").val(),
                        money: $("#money").val(),
                        original_price: $("#original_price").val(),
                        cy: $("#cy").val(),
                        lower_limit1: $("#lower_limit1").val(),
                        consumption1: $("#consumption1").val(),
                        lower_limit2: $("#lower_limit2").val(),
                        consumption2: $("#consumption2").val(),
                        lower_limit3: $("#lower_limit3").val(),
                        consumption3: $("#consumption3").val(),
                        lower_limit4: $("#lower_limit4").val(),
                        consumption4: $("#consumption4").val(),
                        lower_limit5: $("#lower_limit5").val(),
                        consumption5: $("#consumption5").val()
                    },
                    dataType: "json",
                    success: function () {
                        layer.close(index1);
                        layer.alert('成功', {icon: 1}, function (index) {
                            layer.close(index);
                            common();
                        });
                    }
                });
            },
            cancel: function () {
            }
        });
        $(document).ready(calendarOne('hour', "#starttime"));
    });


    $("#send_valid").on('click', function () {
        layer.alert('确认应用吗？', {icon: 0, btn: ['确定', '取消'], shadeClose: true}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=913",
                data: {
                    gi:$("#group").val(),
                    si:$("#s").val()
                },
                dataType: "json",
                success: function (json) {
                    if(json.status==1){
                        layer.alert('成功', {icon: 1}, function (index) {
                            layer.close(index);
                        });
                    }else if(json.status==2){
                        layer.alert('无团购商品', {icon: 2}, function (index) {
                            layer.close(index);
                        });
                    }else{
                        layer.alert('部分服务器失败'+json.msg, {icon: 0}, function (index) {
                            layer.close(index);
                        });
                    }

                }
            });
        });
    });

    $('#content').on('click', 'a[data-type="update"]', function() {
        var id = $(this).parents('tr').find('td').eq(0).text();
        $.ajax({
            type: "POST",
            url: location.href + "&jinIf=915",
            data: {
                id: id
            },
            dataType: "json",
            success: function (json) {
                var  item = JSON.parse(json.item);
                console.log(json)
                layer.open({
                    type: 1,
                    closeBtn: 2,
                    title: '添加团购商品',
                    area: ['540px', '800px'],
                    btn: ['确认', '取消'],
                    btnAlign: 'c',
                    shadeClose: true, //点击遮罩关闭
                    content:'<div class="jin-child">' +
                    '<div class="input-group"><span class="input-group-addon">档位ID</span><input type="text" id="gear_id"  class="form-control" value="'+json.gear_id+'" style="text-align: center;"></div>' +
                    '<div class="input-group"><span class="input-group-addon">开启时间</span><input type="text" id="starttime" class="form-control jin-datetime-long" value="'+json.start_time+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">持续时间</span><input type="text" id="durationtime"  class="form-control"   style="text-align: center;" value="'+json.duration_time+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">奖励-亡灵游侠(0)</span><input type="text" id="item0"  class="form-control"  placeholder="物品1#数量1#-1;物品2#数量2#-1;"  style="text-align: center;" value="'+item[0]+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">奖励-亡灵游侠(1)</span><input type="text" id="item1"  class="form-control"  placeholder="物品1#数量1#-1;物品2#数量2#-1;" style="text-align: center;" value="'+item[1]+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">奖励-维京战士(10)</span><input type="text" id="item10"  class="form-control" placeholder="物品1#数量1#-1;物品2#数量2#-1;"  style="text-align: center;" value="'+item[10]+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">奖励-维京战士(11)</span><input type="text" id="item11"  class="form-control" placeholder="物品1#数量1#-1;物品2#数量2#-1;"  style="text-align: center;" value="'+item[11]+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">奖励-法师(20)</span><input type="text" id="item20"  class="form-control" placeholder="物品1#数量1#-1;物品2#数量2#-1;"  style="text-align: center;" value="'+item[20]+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">奖励-货币</span><input type="text" id="money"  class="form-control" placeholder="货币1#数量1;货币2#数量2;"  style="text-align: center;" value="'+json.money+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">原始价格</span><input type="text" id="original_price"  class="form-control"  style="text-align: center;" value="'+json.original_price+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">限制货币类型</span><input type="text" id="cy"  class="form-control" placeholder="限制团购货币购买类型"  style="text-align: center;" value="'+json.cy+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件1下限</span><input type="text" id="lower_limit1" class="form-control"  style="text-align: center;" value="'+json.lower_limit1+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件1消耗</span><input type="text" id="consumption1"  class="form-control"  style="text-align: center;" value="'+json.consumption1+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件2下限</span><input type="text" id="lower_limit2" class="form-control"  style="text-align: center;" value="'+json.lower_limit2+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件2消耗</span><input type="text" id="consumption2"  class="form-control"  style="text-align: center;" value="'+json.consumption2+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件3下限</span><input type="text" id="lower_limit3"  class="form-control"  style="text-align: center;" value="'+json.lower_limit3+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件3消耗</span><input type="text" id="consumption3"  class="form-control"  style="text-align: center;" value="'+json.consumption3+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件4下限</span><input type="text" id="lower_limit4" class="form-control"  style="text-align: center;" value="'+json.lower_limit4+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件4消耗</span><input type="text" id="consumption4"  class="form-control"  style="text-align: center;" value="'+json.consumption4+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件5下限</span><input type="text" id="lower_limit5" class="form-control"  style="text-align: center;" value="'+json.lower_limit5+'"></div>' +
                    '<div class="input-group"><span class="input-group-addon">条件5消耗</span><input type="text" id="consumption5"  class="form-control"  style="text-align: center;" value="'+json.consumption5+'"></div>' +
                    '</div>',
                    yes: function (index1) {
                        $.ajax({
                            type: "POST",
                            url: location.href + "&jinIf=916",
                            data: {
                                id: id,
                                gear_id: $("#gear_id").val(),
                                start_time: $("#starttime").val(),
                                duration_time: $("#durationtime").val(),
                                item0: $("#item0").val(),
                                item1: $("#item1").val(),
                                item10: $("#item10").val(),
                                item11: $("#item11").val(),
                                item20: $("#item20").val(),
                                money: $("#money").val(),
                                original_price: $("#original_price").val(),
                                cy: $("#cy").val(),
                                lower_limit1: $("#lower_limit1").val(),
                                consumption1: $("#consumption1").val(),
                                lower_limit2: $("#lower_limit2").val(),
                                consumption2: $("#consumption2").val(),
                                lower_limit3: $("#lower_limit3").val(),
                                consumption3: $("#consumption3").val(),
                                lower_limit4: $("#lower_limit4").val(),
                                consumption4: $("#consumption4").val(),
                                lower_limit5: $("#lower_limit5").val(),
                                consumption5: $("#consumption5").val()
                            },
                            dataType: "json",
                            success: function () {
                                layer.close(index1);
                                layer.alert('修改成功', {icon: 1}, function (index) {
                                    layer.close(index);
                                    common();
                                });
                            }
                        });
                    },
                    cancel: function () {
                    }
                });
                $(document).ready(calendarOne('hour', "#starttime"));
            }
        });

    })

</script>