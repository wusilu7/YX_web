{{include file="../common/1header.html"}}
<!--|↓↓↓↓↓↓|-->
<div class="jin-content-title"><span>违规聊天监控</span></div>
<!--查询div-->
<style>
    .alert-info{
        color: white;
    }
    .form-group{
        margin-bottom: 35px;
    }
</style>
<div class="alert alert-info">
    <div class="form-group" id="group_server_5"></div>
</div>
<hr/>
<div class="jin-search-div">
    <div>
        <label for="time_start">日期：</label>
        <input size="16" type="text" id="time_start" class="form-control jin-datetime-long"
               placeholder="开始日期">
        -
        <input size="16" type="text" id="time_end" class="form-control jin-datetime-long"
               placeholder="结束日期">
    </div>
    <div>
        <label for="player_name">筛选：</label>
        <input id="player_name" type="text" class="form-control jin-search-input" placeholder="角色ID/角色名">
        <input id="code" type="text" class="form-control jin-search-input" placeholder="设备号">
        <input id="accont" type="text" class="form-control jin-search-input" placeholder="账号">
        <input id="ip" type="text" class="form-control jin-search-input" placeholder="IP">
        <a id="jin_search" class="btn btn-success"><span class="glyphicon glyphicon-search"></span></a>
        <input size="16" type="checkbox" id="ischeck" value="1">
        <label  style="margin-left: 0px;">自动刷新</label>
        &nbsp;
        <input type="text" id="time_num" placeholder="单位秒，不填默认5秒">
    </div>
</div>
<hr/>
<div class="table-responsive">
    <table class="table table-striped text-center">
        <thead>
        <tr>
            <th>编号</th>
            <th>渠道</th>
            <th>服务器</th>
            <th>服务器ID</th>
            <th>账号</th>
            <th>设备号</th>
            <th>IP</th>
            <th>角色ID</th>
            <th>角色名</th>
            <th>聊天内容</th>
            <th>聊天时间</th>
            <th>踢下线</th>
            <th>禁言</th>
            <th>封号</th>
            <th>封设备</th>
            <th>封IP</th>
            <th>解除禁言</th>
            <th>解除封号</th>
            <th>状态</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody id="content"></tbody>
    </table>
</div>
<div id="page"></div>
<div class="jin-explain">
    <b>说明</b>：
    <div>
        ①查询条件可以按需自由组合，不填代表查询所有；
    </div>
</div>
<!--|↑↑↑↑↑↑|-->
{{include file="../common/2footer.html"}}
<script>
    var kick = function () {
        var c = '<div class="btn-group btn-group-sm">' +
            '<a data-type="kick"  class="btn btn-danger">踢下线</a>' +
            '</div>';
        return c;
    };
    var shutup =  function () {
        var c = '<div class="btn-group btn-group-sm">' +
            '<a data-type="shutup"  class="btn btn-danger">禁言</a>' +
            '</div>';
        return c;
    };
    var ban =   function () {
        var c = '<div class="btn-group btn-group-sm">' +
            '<a data-type="ban"  class="btn btn-danger">封号</a>' +
            '</div>';
        return c;
    };
    var banCode =   function () {
        var c = '<div class="btn-group btn-group-sm">' +
            '<a data-type="banCode"  class="btn btn-danger">封设备</a>' +
            '</div>';
        return c;
    };
    var banIP =   function () {
        var c = '<div class="btn-group btn-group-sm">' +
            '<a data-type="banIP"  class="btn btn-danger">封IP</a>' +
            '</div>';
        return c;
    };
    var relieveshutup =  function () {
        var c = '<div class="btn-group btn-group-sm">' +
            '<a data-type="relieveshutup"  class="btn btn-success">解除禁言</a>' +
            '</div>';
        return c;
    };
    var relieveban =   function () {
        var c = '<div class="btn-group btn-group-sm">' +
            '<a data-type="relieveban"  class="btn btn-success">解除封号</a>' +
            '</div>';
        return c;
    };
    var dispose =   function () {
        var c = '<div class="btn-group btn-group-sm">' +
            '<a data-type="dispose"  class="btn btn-success">确认处理</a>' +
            '</div>';
        return c;
    };
    gsSelect3('#g', '#p', '#s');
    calendar('day', '#time_start', '#time_end');
    var url = location.href + "&jinIf=912";
    var arr = ['id','group_name','server_name','si','account','code','ip','char_guid', 'char_name', 'char_msg', 'logtime', kick, shutup, ban,banCode,banIP,relieveshutup,relieveban,'mask_type', dispose];
    var id = ["#content", "#page"];
    var data = {page: 1};
    var time = '';
    $("#jin_search").on('click', function () {
        if ($('#s').val()=="") {
            layer.msg('请选择服务器');
            return false;
        }
        if ($('#ischeck').is(':checked')) {
            clearInterval(time);
            common();
            num  = 5;
            if($("#time_num").val()){
                num = $("#time_num").val();
            }
            time=setInterval(common,num*1000);
        }else{
            clearInterval(time);
            common();
        }
    });

    function common() {
        data.page = 1;
        data.si = $('#s').val();
        data.pi = $('#p').val();
        data.code = $('#code').val();
        data.account = $('#accont').val();
        data.ip = $('#ip').val();
        data.chat_type = $('#chat_type').val();
        data.time_start = $('#time_start').val();//查询开始时间;
        data.time_end = $('#time_end').val();//查询结束时间
        data.player_name = $("#player_name").val();//角色
        tableList(url, data, id, arr);
    }

    $('#content').on('click', 'a[data-type="kick"]', function () {
        var id = $(this).parents('tr').find('td').eq(0).text();
        var char_name = $(this).parents('tr').find('td').eq(8).text();
        var char_guid = $(this).parents('tr').find('td').eq(7).text();
        var si = $(this).parents('tr').find('td').eq(3).text();
        layer.alert('确认把'+char_name+'踢下线？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=913",
                data: {
                    id :id,
                    si : si,
                    char_guid: char_guid
                },
                dataType: 'json',
                success: function (json) {
                    if (json.result==1) {
                        layer.alert('成功', {icon: 1}, function (index) {
                            layer.close(index);
                        });
                    } else {
                        layer.alert('失败', {icon: 2}, function (index) {
                            layer.close(index);
                        });
                    }
                }
            });
        });
    }).on('click', 'a[data-type="shutup"]', function () {
        var id = $(this).parents('tr').find('td').eq(0).text();
        var char_name = $(this).parents('tr').find('td').eq(8).text();
        var char_guid = $(this).parents('tr').find('td').eq(7).text();
        var si = $(this).parents('tr').find('td').eq(3).text();
        layer.alert('确认把'+char_name+'禁言1周？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=914",
                data: {
                    id :id,
                    si : si,
                    char_guid: char_guid
                },
                dataType: 'json',
                success: function (json) {
                    if (json.result==1) {
                        layer.alert('成功', {icon: 1}, function (index) {
                            layer.close(index);
                        });
                    } else {
                        layer.alert('失败', {icon: 2}, function (index) {
                            layer.close(index);
                        });
                    }
                }
            });
        });
    }).on('click', 'a[data-type="relieveshutup"]', function () {
        var char_name = $(this).parents('tr').find('td').eq(8).text();
        var char_guid = $(this).parents('tr').find('td').eq(7).text();
        var si = $(this).parents('tr').find('td').eq(3).text();
        layer.alert('确认把'+char_name+'解除禁言？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=922",
                data: {
                    si : si,
                    char_guid: char_guid
                },
                dataType: 'json',
                success: function (json) {
                    if (json.result==1) {
                        layer.alert('成功', {icon: 1}, function (index) {
                            layer.close(index);
                        });
                    } else {
                        layer.alert('失败', {icon: 2}, function (index) {
                            layer.close(index);
                        });
                    }
                }
            });
        });
    }).on('click', 'a[data-type="ban"]', function () {
        var char_name = $(this).parents('tr').find('td').eq(8).text();
        var account = $(this).parents('tr').find('td').eq(4).text();
        layer.alert('确认把'+char_name+'封号？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=915",
                data: {
                    con :account
                },
                dataType: 'json',
                success: function (json) {
                    layer.alert('成功', {icon: 1}, function (index) {
                        layer.close(index);
                    });
                }
            });
        });
    }).on('click', 'a[data-type="relieveban"]', function () {
        var char_name = $(this).parents('tr').find('td').eq(8).text();
        var account = $(this).parents('tr').find('td').eq(4).text();
        layer.alert('确认把'+char_name+'解除封号？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=921",
                data: {
                    con :account
                },
                dataType: 'json',
                success: function (json) {
                    layer.alert('成功', {icon: 1}, function (index) {
                        layer.close(index);
                    });
                }
            });
        });
    }).on('click', 'a[data-type="banCode"]', function () {
        var char_name = $(this).parents('tr').find('td').eq(8).text();
        var code = $(this).parents('tr').find('td').eq(5).text();
        layer.alert('确认把'+char_name+'封设备？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=915",
                data: {
                    con: code
                },
                dataType: 'json',
                success: function (json) {
                    layer.alert('成功', {icon: 1}, function (index) {
                        layer.close(index);
                    });
                }
            });
        });
    }).on('click', 'a[data-type="banIP"]', function () {
        var char_name = $(this).parents('tr').find('td').eq(8).text();
        var ip = $(this).parents('tr').find('td').eq(6).text();
        layer.alert('确认把'+char_name+'封IP？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=915",
                data: {
                    con : ip
                },
                dataType: 'json',
                success: function (json) {
                    layer.alert('成功', {icon: 1}, function (index) {
                        layer.close(index);
                    });
                }
            });
        });
    }).on('click', 'a[data-type="dispose"]', function () {
        var ids = $(this).parents('tr').find('td').eq(0).text();
        layer.alert('确认处理过？', {icon: 0, btn: ['确定', '取消']}, function () {
            $.ajax({
                type: "POST",
                url: location.href + "&jinIf=916",
                data: {
                    id :ids
                },
                dataType: 'json',
                success: function (json) {
                    layer.alert('成功', {icon: 1}, function (index) {
                        layer.close(index);
                        tableList(url, data, id, arr);
                    });
                }
            });
        });
    });
</script>